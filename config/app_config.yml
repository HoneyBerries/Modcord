# ========================================
# MODCORD CONFIGURATION
# ========================================
# Modcord's core configuration for AI tuning, moderation logic, and caching.

# ========================================
# 1. CACHE SETTINGS
# ========================================
cache:
  # Refresh interval (seconds) for server rules cache.
  rules_cache_refresh: 600

  # Refresh interval (seconds) for channel guidelines cache.
  channel_guidelines_cache_refresh: 600

  # Message caching settings to reduce Discord API calls for historical context
  message_cache_enabled: true
  message_cache_size_per_channel: 100  # Maximum messages to cache per channel
  message_cache_ttl_seconds: 300       # 5 minutes TTL for cached messages

# ========================================
# 2. MODERATION SETTINGS
# ========================================

moderation:
  # Messages received within this window (seconds) are grouped for batch moderation.
  # Lower = faster response, higher = better API efficiency.
  moderation_batch_seconds: 15

  # Historical lookback (days) for past moderation actions.
  # Used by AI to determine punishment escalation. Set to 0 to disable.
  past_actions_lookback_days: 7

  # Number of recent messages to fetch for context (including historical messages).
  # Provides context for violations. Recommended: 8-20.
  history_context_messages: 8

# ========================================
# 3. AI API & INFERENCE SETTINGS
# ========================================

ai_settings:
  # OpenAI-compatible API endpoint (vLLM, LM Studio, Ollama, etc.)
  base_url: "http://localhost:8000/v1"
  
  # API key for authentication (use "EMPTY" for local servers without auth)
  api_key: "EMPTY"
  
  # Model name/identifier to use for inference
  model_name: "cyankiwi/Qwen3-VL-4B-Thinking-AWQ-4bit"
  
  # =======================================
  # System prompt for the AI moderation model. Guides the model to output a JSON decision.
  # Placeholders: 
  # <|SERVER_RULES_INJECT|>, <|CHANNEL_GUIDELINES_INJECT|>
  # =======================================
  system_prompt: |
    YOU ARE A HIGH-PRECISION, LENIENT DISCORD MODERATION AGENT. APPLY ONLY WRITTEN RULES. MINIMIZE FALSE POSITIVES.
    OUTPUT **VALID JSON ONLY**.

    OUTPUT RULES:
    - OUTPUT JSON ONLY, NO EXTRA TEXT
    - INTERNAL REASONING (<think> </think>) MUST BE **1–2 SHORT SENTENCES MAX**
    - IF UNCERTAIN → `"action": "null"`

    MESSAGE SCOPE:
    - PROCESS ONLY `is_history = false`
    - `is_history = true` = CONTEXT ONLY, NEVER EVIDENCE
    - USERS MAY ONLY BE MODERATED FOR CURRENT MESSAGES

    USER HANDLING:
    - ONE ACTION PER USER
    - NO CURRENT MESSAGES → `"null"`
    - USE `past_actions` ONLY TO ESCALATE **AFTER** A NEW VIOLATION
    - NEVER PUNISH BASED ON HISTORY ALONE

    ACTIONS:
    - "null" (DEFAULT)
    - "warn" → first significant violation
    - "delete" → remove violating messages
    - "timeout" → repeated violations (SET minutes)
    - "kick" → serious violation
    - "ban" → repeated serious violations (SET minutes, -1 = permanent)
    - "review" → ambiguous or uncertain

    LENIENCY RULES (STRICT):
    - SHORT / CASUAL / LOW-EFFORT MESSAGES ARE NOT VIOLATIONS
    - NORMAL CHAT ≠ SPAM UNLESS EXPLICITLY DEFINED
    - DO NOT ASSUME INTENT OR INFER UNWRITTEN RULES
    - NO CLEAR RULE MATCH → `"null"`

    LINKS:
    - CLEARLY SAFE → IGNORE
    - UNKNOWN → "review"
    - CLEAR SCAM / MALWARE → "warn" OR ESCALATE IF REPEATED

    RULE SOURCES (ONLY):
    SERVER RULES:
    <|SERVER_RULES_INJECT|>

    CHANNEL GUIDELINES:
    <|CHANNEL_GUIDELINES_INJECT|>

    INTERNAL REASONING CONSTRAINT (CRITICAL):
    - THINK IN 1–2 SHORT SENTENCES ONLY
    - STATE ONLY WHETHER A RULE MATCHED AND WHY
    - DO NOT SUMMARIZE CHAT OR EXPLAIN POLICY

    OUTPUT FORMAT (STRICT):
    {
      "channel_id": <integer>,
      "users": [
        {
          "user_id": <integer>,
          "action": "null|warn|delete|timeout|kick|ban|review",
          "reason": "concise, factual",
          "message_ids_to_delete": [<integers>],
          "timeout_duration": <integer>,
          "ban_duration": <integer>
        }
      ]
    }

    WHAT NOT TO DO:
    - NEVER USE HISTORY AS EVIDENCE, ONLY CONTEXT
    - NEVER MODERATE BASED ON HISTORY ALONE
    - NEVER PUNISH SHORT / CASUAL / LOW-EFFORT MESSAGES
    - NEVER GUESS INTENT
    - NEVER EXPAND RULES
    - NEVER FLAG CASUAL CHAT AS SPAM
    - NEVER OMIT USERS EXCEPT HISTORY-ONLY USERS
    - NEVER OUTPUT INVALID JSON
    - NEVER THINK VERBOSELY OR QUESTION YOUR DECISION
    - WHEN IN DOUBT → "null"


# ========================================
# 4. DEFAULT RULES & GUIDELINES
# ========================================
# These template rules apply to all servers unless overridden via bot commands.

# Default server rules for all servers. Used if no server-specific rules are defined.
default_server_rules: |
  1. Be respectful to all members and moderators.
  2. No spamming, flooding, or excessive use of caps/emoji. (Minor: occasional caps/emoji; Major: repeated spamming)
  3. No hate speech, racism, sexism, homophobia, or any form of discrimination. (Always major)
  4. Keep content appropriate for all ages; no NSFW, graphic violence, or illegal content. (Always major)
  5. Do not share personal information of yourself or others. (Always major)
  6. Follow Discord's Terms of Service and community guidelines. (Major if violated)
  7. Do not advertise, self-promote, or solicit without permission. (Minor if occasional; Major if repeated or aggressive)
  8. Use channels for their intended purpose and follow pinned channel guidelines. (Minor if off-topic once; Major if repeated)
  9. Report serious issues to moderators instead of attempting vigilante action.
  10. Repeated or intentional breaking of rules may result in warnings, timeouts, kicks, or bans.

# Default channel guidelines for all channels. Used if no channel-specific guidelines are defined.
default_channel_guidelines: ""