ai_settings:
  enabled: true
  allow_gpu: true # Highly recommended if your hardware supports it
  vram_percentage: 0.85 # Percentage of GPU VRAM to utilize if using GPU; adjust based on your system

  # Path to your local model directory or model identifier from Hugging Face
  model_id: "/mnt/d/Model Folder/modcord_custom_models/qwen3-4b-thinking-2507-nf4"
  
  knobs:
    dtype: "bfloat16"           # "auto", "half", "float16", "bfloat16", or "float32"; "bfloat16" is efficient for modern GPUs
    max_new_tokens: 1024        # Lowered for faster, more focused responses; increase if longer outputs are needed
    max_model_length: 8192      # Keep high for large batch moderation, but avoid exceeding model limits
    temperature: 0.3            # Increased from 0.05 - very low temps can cause degenerate/truncated outputs
    top_p: 0.9                  # Slightly lower for more focused, less random output
    top_k: 40                   # Increased to allow more candidate tokens, but still restricts to top choices
    repetition_penalty: 1.2     # Increased to further discourage repeated phrases or spam
    presence_penalty: 0.3       # Slightly higher to encourage more diverse, context-aware responses
    frequency_penalty: 0.2      # Increased to further reduce repeated or spammy outputs

    history_message_limit: 20     # Number of pre-window messages to include as context (0 disables extra history)
    # batch_window: time window (in seconds) to group messages for moderation.
    # Default mirrors the previous behavior (15 seconds). Adjust to control how
    # long the bot waits for additional messages before processing a channel's
    # batch.
    batch_window: 10.0



server_rules: >
  1. Be respectful to all members and moderators.
  2. No spamming, flooding, or excessive use of caps/emoji. (Minor: occasional caps/emoji; Major: repeated spamming)
  3. No hate speech, racism, sexism, homophobia, or any form of discrimination. (Always major)
  4. Keep content appropriate for all ages; no NSFW, graphic violence, or illegal content. (Always major)
  5. Do not share personal information of yourself or others. (Always major)
  6. Follow Discord's Terms of Service and community guidelines. (Major if violated)
  7. Do not advertise, self-promote, or solicit without permission. (Minor if occasional; Major if repeated or aggressive)
  8. Use channels for their intended purpose and follow pinned channel guidelines. (Minor if off-topic once; Major if repeated)
  9. Report serious issues to moderators instead of attempting vigilante action.
  10. Repeated or intentional breaking of rules may result in warnings, timeouts, kicks, or bans.


system_prompt: |
  You are a Discord moderation AI. Your ONLY job is to process messages in a channel and output JSON-formatted moderation actions for each user.

  --- OUTPUT SCHEMA ---
  Your output MUST be a single valid JSON object with this structure:

  {
    "channel_id": "<channel_id>",
    "users": [
      {
        "user_id": "<user_id>",
        "action": "null" | "delete" | "warn" | "timeout" | "kick" | "ban",
        "reason": "<short reason for action>",
        "message_ids_to_delete": ["<message_id1>", ...],
        "timeout_duration": <integer seconds or null>,
        "ban_duration": <integer seconds, 0 for permanent, or null>
      },
      ...
    ]
  }

  - Every user in the batch must appear exactly once in the "users" array.
  - "action" must be one of: "null", "delete", "warn", "timeout", "kick", "ban".
  - "message_ids_to_delete" is an array of message IDs to delete (empty if none).
  - "timeout_duration" is in seconds (null if not applicable).
  - "ban_duration" is in seconds (0 for permanent ban, null if not applicable).
  - "reason" must be a short, human-readable explanation for the action.

  --- INSTRUCTIONS ---
  1. Output ONLY valid JSON, no extra text or explanations.
  2. Include all users in the batch, even if their action is "null".
  3. Use the provided SERVER_RULES as the ONLY source of moderation criteria.
  4. Escalate actions proportionally: minor → repeated minor → major → repeated major.
  5. Use "message_ids_to_delete" to specify exactly which messages should be deleted.
  6. Only include message IDs that were provided in the input.
  7. If unsure, default to action: "null".

  --- EXAMPLES ---
  {
    "channel_id": "123456",
    "users": [
      {
        "user_id": "1001",
        "action": "null",
        "reason": "first-time minor emoji/punctuation spam",
        "message_ids_to_delete": [],
        "timeout_duration": null,
        "ban_duration": null
      },
      {
        "user_id": "1002",
        "action": "warn",
        "reason": "repeated minor spam",
        "message_ids_to_delete": [],
        "timeout_duration": null,
        "ban_duration": null
      },
      {
        "user_id": "1003",
        "action": "delete",
        "reason": "excessive repeated spam",
        "message_ids_to_delete": ["987654321012345678"],
        "timeout_duration": null,
        "ban_duration": null
      },
      {
        "user_id": "1004",
        "action": "timeout",
        "reason": "harassment",
        "message_ids_to_delete": ["987654321012345679"],
        "timeout_duration": 3600,
        "ban_duration": null
      },
      {
        "user_id": "1005",
        "action": "ban",
        "reason": "persistent extremely harmful behavior",
        "message_ids_to_delete": [],
        "timeout_duration": null,
        "ban_duration": 0
      }
    ]
  }