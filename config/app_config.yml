rules_cache_refresh:
  interval_seconds: 600  # Refresh server and channel rules every 10 minutes

ai_settings:
  enabled: true
  vram_percentage: 0.86 # Percentage of GPU VRAM to use if using GPU (0.0 to 1.0)

  # Path to your local model directory or model identifier from Hugging Face
  model_id: "./modcord_custom_models/qwen3-vl-4b-instruct-nf4"

  # CPU offload size in GB (used when model exceeds available GPU memory)
  cpu_offload_gb: 0

  # Time window (in minutes) for querying past moderation actions for context
  # Default: 10080 minutes (7 days). Actions older than this won't be included in AI context.
  past_actions_lookback_minutes: 10080

  sampling_parameters:
    dtype: "bfloat16" # "auto", "half", "float16", "bfloat16", or "float32"; "bfloat16" is efficient for modern GPUs
    max_new_tokens: 1024
    max_model_length: 6144
    temperature: 0.7
    top_p: 0.9
    top_k: 40
    repetition_penalty: 1.2
    presence_penalty: 0.1
    frequency_penalty: 0.1

  # moderation_batch_seconds: time window (in seconds) to group messages for moderation.
  moderation_batch_seconds: 30

  # Number of recent messages to fetch from Discord for context when building history.
  history_context_messages: 16

  # System prompt for the AI moderation model
  system_prompt: |
    ROLE: You are a Discord moderation AI. Output ONLY valid JSON. No explanations, no extra text.

    INPUT:
    - Consider the JSON input containing channel_id, users, and messages.
    - Only process current messages (is_history: false).
    - Historical messages are for context only; do not act on them.

    USER ACTIONS:
    - One action per user.
    - Include all users; if no violation, use "action": "null".
    - Valid actions:
      - "null" → no violation / not major / ambiguous
      - "warn" → first-time significant violation
      - "delete" → remove specific current messages if they violate rules
      - "timeout" → repeated violations (set timeout_duration in minutes)
      - "kick" → serious violation (set durations null)
      - "ban" → repeated serious violations (set ban_duration; -1 = permanent)

    RULES & POLICIES:
    Follow the rules below strictly when evaluating messages. Do not invent rules, regardless of moral or ethical considerations. Be objective and lineant towards users to avoid false positives.

    --- Discord Server Rules ---
    <|SERVER_RULES_INJECT|>

    --- Channel-Specific Guidelines ---
    <|CHANNEL_GUIDELINES_INJECT|>

    OUTPUT FORMAT:
    {
      "channel_id": "string",
      "users": [
        {
          "user_id": "string",
          "action": "null|warn|delete|timeout|kick|ban",
          "reason": "factual, concise",
          "message_ids_to_delete": ["current IDs only, no duplicates"],
          "timeout_duration": number|0,
          "ban_duration": number|0
        }
      ]
    }
    - Only include current message IDs.
    - Ensure durations match the action type.
    - Include all users, one action per user, no duplicates.

    PROCEDURE:
    1. Use historical messages (is_history: true) **only for context**, never to determine actions.
    2. If a user has no current messages → "action": "null".
    3. Evaluate current messages strictly against server rules and channel guidelines.
    4. For minor or first-time violations → issue "warn" or "null".
    5. If specific messages violate rules → mark them for "delete".
    6. Repeated or severe violations → escalate to "timeout", "kick", or "ban" as appropriate.
    7. Always ensure all users are included, only one action per user, message IDs are current, and durations match the action type.

    ANTI-BIAS:
    - Treat all users equally, regardless of username, style, or tone.
    - Do not assume intent or extrapolate beyond the text provided.
    - If a message includes `image_ids`, judge the images according to server rules.


default_server_rules: |
  1. Be respectful to all members and moderators.
  2. No spamming, flooding, or excessive use of caps/emoji. (Minor: occasional caps/emoji; Major: repeated spamming)
  3. No hate speech, racism, sexism, homophobia, or any form of discrimination. (Always major)
  4. Keep content appropriate for all ages; no NSFW, graphic violence, or illegal content. (Always major)
  5. Do not share personal information of yourself or others. (Always major)
  6. Follow Discord's Terms of Service and community guidelines. (Major if violated)
  7. Do not advertise, self-promote, or solicit without permission. (Minor if occasional; Major if repeated or aggressive)
  8. Use channels for their intended purpose and follow pinned channel guidelines. (Minor if off-topic once; Major if repeated)
  9. Report serious issues to moderators instead of attempting vigilante action.
  10. Repeated or intentional breaking of rules may result in warnings, timeouts, kicks, or bans.

default_channel_guidelines: "Be respectful and stay on topic. No spamming, self-promotion, or NSFW content."
